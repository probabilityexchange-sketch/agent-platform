name: Transaction Scanner
on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch: {}

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger scanner
        run: |
          echo "Calling: ${{ secrets.APP_URL }}/api/cron/scan"
          HTTP_CODE=$(curl -s -o response.txt -w "%{http_code}" \
            -X POST \
            -H "x-cron-secret: ${{ secrets.CRON_SECRET }}" \
            "${{ secrets.APP_URL }}/api/cron/scan")
          echo "HTTP Status: $HTTP_CODE"
          echo "Response:"
          cat response.txt
          if [ "$HTTP_CODE" -ne 200 ]; then
            exit 1
          fi
